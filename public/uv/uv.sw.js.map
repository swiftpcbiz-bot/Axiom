{
  "version": 3,
  "sources": ["../src/uv.sw.js"],
  "sourcesContent": ["/*globals __uv$config*/\r\n// Users must import the config (and bundle) prior to importing uv.sw.js\r\n// This is to allow us to produce a generic bundle with no hard-coded paths.\r\n\r\n/**\r\n * @type {import('../uv').UltravioletCtor}\r\n */\r\nconst Ultraviolet = self.Ultraviolet;\r\n\r\nconst cspHeaders = [\r\n\t\"cross-origin-embedder-policy\",\r\n\t\"cross-origin-opener-policy\",\r\n\t\"cross-origin-resource-policy\",\r\n\t\"content-security-policy\",\r\n\t\"content-security-policy-report-only\",\r\n\t\"expect-ct\",\r\n\t\"feature-policy\",\r\n\t\"origin-isolation\",\r\n\t\"strict-transport-security\",\r\n\t\"upgrade-insecure-requests\",\r\n\t\"x-content-type-options\",\r\n\t\"x-download-options\",\r\n\t\"x-frame-options\",\r\n\t\"x-permitted-cross-domain-policies\",\r\n\t\"x-powered-by\",\r\n\t\"x-xss-protection\",\r\n];\r\nconst emptyMethods = [\"GET\", \"HEAD\"];\r\n\r\nclass UVServiceWorker extends Ultraviolet.EventEmitter {\r\n\tconstructor(config = __uv$config) {\r\n\t\tsuper();\r\n\t\tif (!config.prefix) config.prefix = \"/service/\";\r\n\t\tthis.config = config;\r\n\t\t/**\r\n\t\t * @type {InstanceType<Ultraviolet['BareClient']>}\r\n\t\t */\r\n\t\tthis.bareClient = new Ultraviolet.BareClient();\r\n\t}\r\n\t/**\r\n\t *\r\n\t * @param {Event & {request: Request}} param0\r\n\t * @returns\r\n\t */\r\n\troute({ request }) {\r\n\t\tif (request.url.startsWith(location.origin + this.config.prefix))\r\n\t\t\treturn true;\r\n\t\telse return false;\r\n\t}\r\n\t/**\r\n\t *\r\n\t * @param {Event & {request: Request}} param0\r\n\t * @returns\r\n\t */\r\n\tasync fetch({ request }) {\r\n\t\t/**\r\n\t\t * @type {string|void}\r\n\t\t */\r\n\t\tlet fetchedURL;\r\n\r\n\t\ttry {\r\n\t\t\tif (!request.url.startsWith(location.origin + this.config.prefix))\r\n\t\t\t\treturn await fetch(request);\r\n\r\n\t\t\tconst ultraviolet = new Ultraviolet(this.config);\r\n\r\n\t\t\tif (typeof this.config.construct === \"function\") {\r\n\t\t\t\tthis.config.construct(ultraviolet, \"service\");\r\n\t\t\t}\r\n\r\n\t\t\tconst db = await ultraviolet.cookie.db();\r\n\r\n\t\t\tultraviolet.meta.origin = location.origin;\r\n\t\t\tultraviolet.meta.base = ultraviolet.meta.url = new URL(\r\n\t\t\t\tultraviolet.sourceUrl(request.url)\r\n\t\t\t);\r\n\r\n\t\t\tconst requestCtx = new RequestContext(\r\n\t\t\t\trequest,\r\n\t\t\t\tultraviolet,\r\n\t\t\t\t!emptyMethods.includes(request.method.toUpperCase())\r\n\t\t\t\t\t? await request.blob()\r\n\t\t\t\t\t: null\r\n\t\t\t);\r\n\r\n\t\t\tif (ultraviolet.meta.url.protocol === \"blob:\") {\r\n\t\t\t\trequestCtx.blob = true;\r\n\t\t\t\trequestCtx.base = requestCtx.url = new URL(requestCtx.url.pathname);\r\n\t\t\t}\r\n\r\n\t\t\tif (request.referrer && request.referrer.startsWith(location.origin)) {\r\n\t\t\t\tconst referer = new URL(ultraviolet.sourceUrl(request.referrer));\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\trequestCtx.headers.origin ||\r\n\t\t\t\t\t(ultraviolet.meta.url.origin !== referer.origin &&\r\n\t\t\t\t\t\trequest.mode === \"cors\")\r\n\t\t\t\t) {\r\n\t\t\t\t\trequestCtx.headers.origin = referer.origin;\r\n\t\t\t\t}\r\n\r\n\t\t\t\trequestCtx.headers.referer = referer.href;\r\n\t\t\t}\r\n\r\n\t\t\tconst cookies = (await ultraviolet.cookie.getCookies(db)) || [];\r\n\t\t\tconst cookieStr = ultraviolet.cookie.serialize(\r\n\t\t\t\tcookies,\r\n\t\t\t\tultraviolet.meta,\r\n\t\t\t\tfalse\r\n\t\t\t);\r\n\r\n\t\t\trequestCtx.headers[\"user-agent\"] = navigator.userAgent;\r\n\r\n\t\t\tif (cookieStr) requestCtx.headers.cookie = cookieStr;\r\n\r\n\t\t\tconst reqEvent = new HookEvent(requestCtx, null, null);\r\n\t\t\tthis.emit(\"request\", reqEvent);\r\n\r\n\t\t\tif (reqEvent.intercepted) return reqEvent.returnValue;\r\n\r\n\t\t\tfetchedURL = requestCtx.blob\r\n\t\t\t\t? \"blob:\" + location.origin + requestCtx.url.pathname\r\n\t\t\t\t: requestCtx.url;\r\n\r\n\t\t\tconst response = await this.bareClient.fetch(fetchedURL, {\r\n\t\t\t\theaders: requestCtx.headers,\r\n\t\t\t\tmethod: requestCtx.method,\r\n\t\t\t\tbody: requestCtx.body,\r\n\t\t\t\tcredentials: requestCtx.credentials,\r\n\t\t\t\tmode: requestCtx.mode,\r\n\t\t\t\tcache: requestCtx.cache,\r\n\t\t\t\tredirect: requestCtx.redirect,\r\n\t\t\t});\r\n\r\n\t\t\tconst responseCtx = new ResponseContext(requestCtx, response);\r\n\t\t\tconst resEvent = new HookEvent(responseCtx, null, null);\r\n\r\n\t\t\tthis.emit(\"beforemod\", resEvent);\r\n\t\t\tif (resEvent.intercepted) return resEvent.returnValue;\r\n\r\n\t\t\tfor (const name of cspHeaders) {\r\n\t\t\t\tif (responseCtx.headers[name]) delete responseCtx.headers[name];\r\n\t\t\t}\r\n\r\n\t\t\tif (responseCtx.headers.location) {\r\n\t\t\t\tresponseCtx.headers.location = ultraviolet.rewriteUrl(\r\n\t\t\t\t\tresponseCtx.headers.location\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\t// downloads\r\n\t\t\tif ([\"document\", \"iframe\"].includes(request.destination)) {\r\n\t\t\t\tconst header = responseCtx.getHeader(\"content-disposition\");\r\n\r\n\t\t\t\t// validate header and test for filename\r\n\t\t\t\tif (!/\\s*?((inline|attachment);\\s*?)filename=/i.test(header)) {\r\n\t\t\t\t\t// if filename= wasn't specified then maybe the remote specified to download this as an attachment?\r\n\t\t\t\t\t// if it's invalid then we can still possibly test for the attachment/inline type\r\n\t\t\t\t\tconst type = /^\\s*?attachment/i.test(header)\r\n\t\t\t\t\t\t? \"attachment\"\r\n\t\t\t\t\t\t: \"inline\";\r\n\r\n\t\t\t\t\t// set the filename\r\n\t\t\t\t\tconst [filename] = new URL(response.finalURL).pathname\r\n\t\t\t\t\t\t.split(\"/\")\r\n\t\t\t\t\t\t.slice(-1);\r\n\r\n\t\t\t\t\tresponseCtx.headers[\"content-disposition\"] =\r\n\t\t\t\t\t\t`${type}; filename=${JSON.stringify(filename)}`;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (responseCtx.headers[\"set-cookie\"]) {\r\n\t\t\t\tPromise.resolve(\r\n\t\t\t\t\tultraviolet.cookie.setCookies(\r\n\t\t\t\t\t\tresponseCtx.headers[\"set-cookie\"],\r\n\t\t\t\t\t\tdb,\r\n\t\t\t\t\t\tultraviolet.meta\r\n\t\t\t\t\t)\r\n\t\t\t\t).then(() => {\r\n\t\t\t\t\tself.clients.matchAll().then(function (clients) {\r\n\t\t\t\t\t\tclients.forEach(function (client) {\r\n\t\t\t\t\t\t\tclient.postMessage({\r\n\t\t\t\t\t\t\t\tmsg: \"updateCookies\",\r\n\t\t\t\t\t\t\t\turl: ultraviolet.meta.url.href,\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\tdelete responseCtx.headers[\"set-cookie\"];\r\n\t\t\t}\r\n\r\n\t\t\tif (responseCtx.body) {\r\n\t\t\t\tswitch (request.destination) {\r\n\t\t\t\t\tcase \"script\":\r\n\t\t\t\t\t\tresponseCtx.body = ultraviolet.js.rewrite(await response.text());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"worker\":\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t// craft a JS-safe list of arguments\r\n\t\t\t\t\t\t\tconst scripts = [\r\n\t\t\t\t\t\t\t\tultraviolet.bundleScript,\r\n\t\t\t\t\t\t\t\tultraviolet.clientScript,\r\n\t\t\t\t\t\t\t\tultraviolet.configScript,\r\n\t\t\t\t\t\t\t\tultraviolet.handlerScript,\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t.map((script) => JSON.stringify(script))\r\n\t\t\t\t\t\t\t\t.join(\",\");\r\n\t\t\t\t\t\t\tresponseCtx.body = `if (!self.__uv) {\r\n                                ${ultraviolet.createJsInject(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tultraviolet.cookie.serialize(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcookies,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tultraviolet.meta,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttrue\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\trequest.referrer\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n                            importScripts(${scripts});\r\n                            }\\n`;\r\n\t\t\t\t\t\t\tresponseCtx.body += ultraviolet.js.rewrite(await response.text());\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"style\":\r\n\t\t\t\t\t\tresponseCtx.body = ultraviolet.rewriteCSS(await response.text());\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"iframe\":\r\n\t\t\t\t\tcase \"document\":\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\tresponseCtx.getHeader(\"content-type\") &&\r\n\t\t\t\t\t\t\tresponseCtx.getHeader(\"content-type\").startsWith(\"text/html\")\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tlet modifiedResponse = await response.text();\r\n\t\t\t\t\t\t\tif (Array.isArray(this.config.inject)) {\r\n\t\t\t\t\t\t\t\tconst headPosition = modifiedResponse.indexOf(\"<head>\");\r\n\t\t\t\t\t\t\t\tconst upperHead = modifiedResponse.indexOf(\"<HEAD>\");\r\n\t\t\t\t\t\t\t\tconst bodyPosition = modifiedResponse.indexOf(\"<body>\");\r\n\t\t\t\t\t\t\t\tconst upperBody = modifiedResponse.indexOf(\"<BODY>\");\r\n\t\t\t\t\t\t\t\tconst url = new URL(fetchedURL);\r\n\t\t\t\t\t\t\t\tconst injectArray = this.config.inject;\r\n\t\t\t\t\t\t\t\tfor (const inject of injectArray) {\r\n\t\t\t\t\t\t\t\t\tconst regex = new RegExp(inject.host);\r\n\t\t\t\t\t\t\t\t\tif (regex.test(url.host)) {\r\n\t\t\t\t\t\t\t\t\t\tif (inject.injectTo === \"head\") {\r\n\t\t\t\t\t\t\t\t\t\t\tif (headPosition !== -1 || upperHead !== -1) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tmodifiedResponse =\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tmodifiedResponse.slice(0, headPosition) +\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t`${inject.html}` +\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tmodifiedResponse.slice(headPosition);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t} else if (inject.injectTo === \"body\") {\r\n\t\t\t\t\t\t\t\t\t\t\tif (bodyPosition !== -1 || upperBody !== -1) {\r\n\t\t\t\t\t\t\t\t\t\t\t\tmodifiedResponse =\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tmodifiedResponse.slice(0, bodyPosition) +\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t`${inject.html}` +\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tmodifiedResponse.slice(bodyPosition);\r\n\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tresponseCtx.body = ultraviolet.rewriteHtml(modifiedResponse, {\r\n\t\t\t\t\t\t\t\tdocument: true,\r\n\t\t\t\t\t\t\t\tinjectHead: ultraviolet.createHtmlInject(\r\n\t\t\t\t\t\t\t\t\tultraviolet.handlerScript,\r\n\t\t\t\t\t\t\t\t\tultraviolet.bundleScript,\r\n\t\t\t\t\t\t\t\t\tultraviolet.clientScript,\r\n\t\t\t\t\t\t\t\t\tultraviolet.configScript,\r\n\t\t\t\t\t\t\t\t\tultraviolet.cookie.serialize(cookies, ultraviolet.meta, true),\r\n\t\t\t\t\t\t\t\t\trequest.referrer\r\n\t\t\t\t\t\t\t\t),\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (requestCtx.headers.accept === \"text/event-stream\") {\r\n\t\t\t\tresponseCtx.headers[\"content-type\"] = \"text/event-stream\";\r\n\t\t\t}\r\n\t\t\tif (crossOriginIsolated) {\r\n\t\t\t\tresponseCtx.headers[\"Cross-Origin-Embedder-Policy\"] = \"require-corp\";\r\n\t\t\t}\r\n\r\n\t\t\tthis.emit(\"response\", resEvent);\r\n\t\t\tif (resEvent.intercepted) return resEvent.returnValue;\r\n\r\n\t\t\treturn new Response(responseCtx.body, {\r\n\t\t\t\theaders: responseCtx.headers,\r\n\t\t\t\tstatus: responseCtx.status,\r\n\t\t\t\tstatusText: responseCtx.statusText,\r\n\t\t\t});\r\n\t\t} catch (err) {\r\n\t\t\tif (![\"document\", \"iframe\"].includes(request.destination))\r\n\t\t\t\treturn new Response(undefined, { status: 500 });\r\n\r\n\t\t\tconsole.error(err);\r\n\r\n\t\t\treturn renderError(err, fetchedURL);\r\n\t\t}\r\n\t}\r\n\tstatic Ultraviolet = Ultraviolet;\r\n}\r\n\r\nself.UVServiceWorker = UVServiceWorker;\r\n\r\nclass ResponseContext {\r\n\t/**\r\n\t *\r\n\t * @param {RequestContext} request\r\n\t * @param {import(\"@mercuryworkshop/bare-mux\").BareResponseFetch} response\r\n\t */\r\n\tconstructor(request, response) {\r\n\t\tthis.request = request;\r\n\t\tthis.raw = response;\r\n\t\tthis.ultraviolet = request.ultraviolet;\r\n\t\tthis.headers = {};\r\n\t\t// eg set-cookie\r\n\t\tfor (const key in response.rawHeaders)\r\n\t\t\tthis.headers[key.toLowerCase()] = response.rawHeaders[key];\r\n\t\tthis.status = response.status;\r\n\t\tthis.statusText = response.statusText;\r\n\t\tthis.body = response.body;\r\n\t}\r\n\tget url() {\r\n\t\treturn this.request.url;\r\n\t}\r\n\tget base() {\r\n\t\treturn this.request.base;\r\n\t}\r\n\tset base(val) {\r\n\t\tthis.request.base = val;\r\n\t}\r\n\t//the header value might be an array, so this function is used to\r\n\t//retrieve the value when it needs to be compared against a string\r\n\tgetHeader(key) {\r\n\t\tif (Array.isArray(this.headers[key])) {\r\n\t\t\treturn this.headers[key][0];\r\n\t\t}\r\n\t\treturn this.headers[key];\r\n\t}\r\n}\r\n\r\nclass RequestContext {\r\n\t/**\r\n\t *\r\n\t * @param {Request} request\r\n\t * @param {Ultraviolet} ultraviolet\r\n\t * @param {BodyInit} body\r\n\t */\r\n\tconstructor(request, ultraviolet, body = null) {\r\n\t\tthis.ultraviolet = ultraviolet;\r\n\t\tthis.request = request;\r\n\t\tthis.headers = Object.fromEntries(request.headers.entries());\r\n\t\tthis.method = request.method;\r\n\t\tthis.body = body || null;\r\n\t\tthis.cache = request.cache;\r\n\t\tthis.redirect = request.redirect;\r\n\t\tthis.credentials = \"omit\";\r\n\t\tthis.mode = request.mode === \"cors\" ? request.mode : \"same-origin\";\r\n\t\tthis.blob = false;\r\n\t}\r\n\tget url() {\r\n\t\treturn this.ultraviolet.meta.url;\r\n\t}\r\n\tset url(val) {\r\n\t\tthis.ultraviolet.meta.url = val;\r\n\t}\r\n\tget base() {\r\n\t\treturn this.ultraviolet.meta.base;\r\n\t}\r\n\tset base(val) {\r\n\t\tthis.ultraviolet.meta.base = val;\r\n\t}\r\n}\r\n\r\nclass HookEvent {\r\n\t#intercepted;\r\n\t#returnValue;\r\n\tconstructor(data = {}, target = null, that = null) {\r\n\t\tthis.#intercepted = false;\r\n\t\tthis.#returnValue = null;\r\n\t\tthis.data = data;\r\n\t\tthis.target = target;\r\n\t\tthis.that = that;\r\n\t}\r\n\tget intercepted() {\r\n\t\treturn this.#intercepted;\r\n\t}\r\n\tget returnValue() {\r\n\t\treturn this.#returnValue;\r\n\t}\r\n\trespondWith(input) {\r\n\t\tthis.#returnValue = input;\r\n\t\tthis.#intercepted = true;\r\n\t}\r\n}\r\n\r\n/**\r\n *\r\n * @param {string} trace\r\n * @param {string} fetchedURL\r\n * @returns\r\n */\r\nfunction errorTemplate(trace, fetchedURL) {\r\n\t// turn script into a data URI so we don't have to escape any HTML values\r\n\tconst script = `\r\n        errorTrace.value = ${JSON.stringify(trace)};\r\n        fetchedURL.textContent = ${JSON.stringify(fetchedURL)};\r\n        for (const node of document.querySelectorAll(\"#uvHostname\")) node.textContent = ${JSON.stringify(\r\n\t\t\t\t\tlocation.hostname\r\n\t\t\t\t)};\r\n        reload.addEventListener(\"click\", () => location.reload());\r\n        uvVersion.textContent = ${JSON.stringify(\r\n\t\t\t\t\tprocess.env.ULTRAVIOLET_VERSION\r\n\t\t\t\t)};\r\n        uvBuild.textContent = ${JSON.stringify(\r\n\t\t\t\t\tprocess.env.ULTRAVIOLET_COMMIT_HASH\r\n\t\t\t\t)};\r\n    `;\r\n\r\n\treturn `<!DOCTYPE html>\r\n        <html>\r\n        <head>\r\n        <meta charset='utf-8' />\r\n        <title>Error</title>\r\n        <style>\r\n        * { background-color: white }\r\n        </style>\r\n        </head>\r\n        <body>\r\n        <h1 id='errorTitle'>Error processing your request</h1>\r\n        <hr />\r\n        <p>Failed to load <b id=\"fetchedURL\"></b></p>\r\n        <p id=\"errorMessage\">Internal Server Error</p>\r\n        <textarea id=\"errorTrace\" cols=\"40\" rows=\"10\" readonly></textarea>\r\n        <p>Try:</p>\r\n        <ul>\r\n        <li>Checking your internet connection</li>\r\n        <li>Verifying you entered the correct address</li>\r\n        <li>Clearing the site data</li>\r\n        <li>Contacting <b id=\"uvHostname\"></b>'s administrator</li>\r\n        <li>Verify the server isn't censored</li>\r\n        </ul>\r\n        <p>If you're the administrator of <b id=\"uvHostname\"></b>, try:</p>\r\n        <ul>\r\n        <li>Restarting your server</li>\r\n        <li>Updating Ultraviolet</li>\r\n        <li>Troubleshooting the error on the <a href=\"https://github.com/titaniumnetwork-dev/Ultraviolet\" target=\"_blank\">GitHub repository</a></li>\r\n        </ul>\r\n        <button id=\"reload\">Reload</button>\r\n        <hr />\r\n        <p><i>Ultraviolet v<span id=\"uvVersion\"></span> (build <span id=\"uvBuild\"></span>)</i></p>\r\n        <script src=\"${\r\n\t\t\t\t\t\"data:application/javascript,\" + encodeURIComponent(script)\r\n\t\t\t\t}\"></script>\r\n        </body>\r\n        </html>\r\n        `;\r\n}\r\n\r\n/**\r\n *\r\n * @param {unknown} err\r\n * @param {string} fetchedURL\r\n */\r\nfunction renderError(err, fetchedURL) {\r\n\tlet headers = {\r\n\t\t\"content-type\": \"text/html\",\r\n\t};\r\n\tif (crossOriginIsolated) {\r\n\t\theaders[\"Cross-Origin-Embedder-Policy\"] = \"require-corp\";\r\n\t}\r\n\r\n\treturn new Response(errorTemplate(String(err), fetchedURL), {\r\n\t\tstatus: 500,\r\n\t\theaders: headers,\r\n\t});\r\n}\r\n"],
  "mappings": "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",
  "names": ["Ultraviolet", "cspHeaders", "emptyMethods", "UVServiceWorker", "config", "request", "fetchedURL", "ultraviolet", "db", "requestCtx", "RequestContext", "referer", "cookies", "cookieStr", "reqEvent", "HookEvent", "response", "responseCtx", "ResponseContext", "resEvent", "name", "header", "type", "filename", "clients", "client", "scripts", "script", "modifiedResponse", "headPosition", "upperHead", "bodyPosition", "upperBody", "url", "injectArray", "inject", "err", "renderError", "key", "val", "body", "#intercepted", "#returnValue", "data", "target", "that", "input", "errorTemplate", "trace", "headers"]
}
