<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Axiom Settings</title>
    <script src="./js/themeManager.js"></script>
    <script src="./js/plugins.js" defer></script>
    <style>
    
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: var(--theme-primary);
            color: var(--theme-textPrimary);
            overflow-x: hidden;
            min-height: 100vh;
        }

        .header {
            display: flex;
            align-items: center;
            padding: 20px;
            background-color: var(--theme-surface);
            box-shadow: 0 2px 8px var(--theme-shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .back-button {
            background: none;
            border: none;
            color: var(--theme-textPrimary);
            font-size: 24px;
            cursor: pointer;
            margin-right: 15px;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .back-button:hover {
            background-color: var(--theme-overlay);
        }

        .header h1 {
            margin: 0;
            font-size: 28px;
            font-weight: 600;
        }

        .settings-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .settings-section {
            background-color: var(--theme-surface);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 12px var(--theme-shadow);
        }

        .section-title {
            font-size: 20px;
            font-weight: 600;
            margin: 0 0 20px 0;
            color: var(--theme-textPrimary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .section-title .material-symbols-outlined {
            font-size: 24px;
            color: var(--theme-textSecondary);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid var(--theme-overlay);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-info {
            flex: 1;
        }

        .setting-label {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 4px;
            color: var(--theme-textPrimary);
        }

        .setting-description {
            font-size: 14px;
            color: var(--theme-textTertiary);
            line-height: 1.4;
        }

        .setting-control {
            min-width: 120px;
            text-align: right;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--theme-surfaceLight);
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--theme-textSecondary);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .theme-picker-wrapper {
            padding: 16px 0;
        }

        #theme-picker-container .theme-picker {
            background: transparent !important;
            padding: 0 !important;
            box-shadow: none !important;
        }

        .dropdown-select {
            background-color: var(--theme-surface);
            border: 1px solid var(--theme-surfaceLight);
            border-radius: 8px;
            color: var(--theme-textPrimary);
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
            outline: none;
            min-width: 120px;
        }

        .dropdown-select:hover {
            border-color: var(--theme-textSecondary);
        }

        .input-field {
            background-color: var(--theme-surface);
            border: 1px solid var(--theme-surfaceLight);
            border-radius: 8px;
            color: var(--theme-textPrimary);
            padding: 8px 12px;
            font-size: 14px;
            outline: none;
            min-width: 200px;
        }

        .input-field:focus {
            border-color: var(--theme-textSecondary);
        }

        .input-field::placeholder {
            color: var(--theme-textMuted);
        }

        .button {
            background-color: var(--theme-textSecondary);
            color: var(--theme-primary);
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .button:hover {
            background-color: #d8d8d8;
            transform: translateY(-1px);
        }

        .button.secondary {
            background-color: var(--theme-surfaceLight);
        }

        .button.secondary:hover {
            background-color: var(--theme-surfaceDark);
        }

        .version-info {
            text-align: center;
            padding: 20px;
            color: var(--theme-textMuted);
            font-size: 14px;
            border-top: 1px solid var(--theme-overlay);
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .settings-container {
                padding: 20px 15px;
            }

            .settings-section {
                padding: 20px;
                margin-bottom: 20px;
            }

            .setting-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .setting-control {
                text-align: left;
                min-width: auto;
                width: 100%;
            }

            .input-field {
                min-width: 100%;
            }
        }
    </style>
</head>

<body>

    <div class="settings-container">
        <div class="settings-section">
            <h2 class="section-title">
                <span class="material-symbols-outlined">palette</span>
                Appearance
            </h2>
            
            <div class="setting-item">
                <div class="setting-info">
                    <div class="setting-label">Theme</div>
                    <div class="setting-description">Choose your preferred color scheme</div>
                </div>
                <div class="setting-control">
                    <div class="theme-picker-wrapper">
                        <div id="theme-picker-container"></div>
                    </div>
                </div>
            </div>

            <div class="setting-item">
                <div class="setting-info">
                    <div class="setting-label">Auto Theme</div>
                    <div class="setting-description">Automatically switch theme based on system preference</div>
                </div>
                <div class="setting-control">
                    <label class="toggle-switch">
                        <input type="checkbox" id="auto-theme-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <h2 class="section-title">
                <span class="material-symbols-outlined">public</span>
                Browser
            </h2>

            <div class="setting-item">
                <div class="setting-info">
                    <div class="setting-label">Homepage</div>
                    <div class="setting-description">Page to load when opening new tabs</div>
                </div>
                <div class="setting-control">
                    <select class="dropdown-select" id="homepage-select">
                        <option value="start.html">Axiom Start Page</option>
                        <option value="games.html">Games Page</option>
                        <option value="custom">Custom URL</option>
                    </select>
                </div>
            </div>

            <div class="setting-item" id="custom-homepage-item" style="display: none;">
                <div class="setting-info">
                    <div class="setting-label">Custom Homepage URL</div>
                    <div class="setting-description">Enter a custom URL for your homepage</div>
                </div>
                <div class="setting-control">
                    <input type="url" class="input-field" id="custom-homepage-input" placeholder="https://example.com">
                </div>
            </div>

            <div class="setting-item">
                <div class="setting-info">
                    <div class="setting-label">Default Search Engine</div>
                    <div class="setting-description">Search engine used for queries in the address bar</div>
                </div>
                <div class="setting-control">
                    <select class="dropdown-select" id="search-engine-select">
                        <option value="https://search.brave.com/search?q=">Brave Search</option>
                        <option value="https://www.google.com/search?q=">Google</option>
                        <option value="https://duckduckgo.com/?q=">DuckDuckGo</option>
                        <option value="https://www.bing.com/search?q=">Bing</option>
                    </select>
                </div>
            </div>

            <div class="setting-item">
                <div class="setting-info">
                    <div class="setting-label">Proxy</div>
                    <div class="setting-description">Select the proxy backend to use for browsing</div>
                </div>
                <div class="setting-control">
                    <select class="dropdown-select" id="proxy-select">
                        <option value="ultraviolet">Ultraviolet</option>
                        <option value="scramjet">Scramjet</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Privacy & Security -->
        <div class="settings-section">
            <h2 class="section-title">
                <span class="material-symbols-outlined">security</span>
                Privacy & Security
            </h2>

            <div class="setting-item">
                <div class="setting-info">
                    <div class="setting-label">Block Popups</div>
                    <div class="setting-description">Prevent popup windows from appearing</div>
                </div>
                <div class="setting-control">
                    <label class="toggle-switch">
                        <input type="checkbox" id="block-popups-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="setting-item">
                <div class="setting-info">
                    <div class="setting-label">Clear Browsing Data</div>
                    <div class="setting-description">Remove tabs, history, and other stored data</div>
                </div>
                <div class="setting-control">
                    <button class="button secondary" onclick="clearBrowsingData()">Clear Data</button>
                </div>
            </div>
        </div>

        <!-- Advanced -->
        <div class="settings-section">
            <h2 class="section-title">
                <span class="material-symbols-outlined">tune</span>
                Advanced
            </h2>

            <div class="setting-item">
                <div class="setting-info">
                    <div class="setting-label">Developer Mode</div>
                    <div class="setting-description">Enable developer tools and advanced features</div>
                </div>
                <div class="setting-control">
                    <label class="toggle-switch">
                        <input type="checkbox" id="developer-mode-toggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>

            <div class="setting-item">
                <div class="setting-info">
                    <div classproxy-select="setting-label">Reset Settings</div>
                    <div class="setting-description">Reset all settings to their default values</div>
                </div>
                <div class="setting-control">
                    <button class="button secondary" onclick="resetSettings()">Reset</button>
                </div>
            </div>
        </div>

        <!-- Premium -->
        <div class="settings-section">
            <h2 class="section-title">
                <span class="material-symbols-outlined">key</span>
                Premium
            </h2>

            <div class="setting-item">
                <div class="setting-info">
                    <div class="setting-label">Premium Key</div>
                    <div class="setting-description">Enter your premium key to unlock advanced features</div>
                </div>
                <div class="setting-control">
                    <input type="text" class="input-field" id="premium-key-input" placeholder="Enter premium key">
                    <button class="button" onclick="addPremiumKey()">Add Key</button>
                </div>
            </div>
        </div>

        <div class="version-info">
            Axiom Browser v3 Alpha - Built with ❤️ for privacy and speed
        </div>
    </div>

    <script>
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeSettings();
        });

        function initializeSettings() {
            const themeContainer = document.getElementById('theme-picker-container');
            if (window.themeManager) {
                window.themeManager.createThemePicker(themeContainer);
            }

            loadSettings();

            const savedPremiumKey = localStorage.getItem('axiomPremiumKey') || '';
            document.getElementById('premium-key-input').value = savedPremiumKey;
            
            setupEventListeners();
        }

        function addPremiumKey() {
            const key = document.getElementById('premium-key-input').value.trim();
            if (key) {
                window.axiom.setKey(key);
                window.axiom.getKeyInfo(key);
                alert('Premium key added and verified.');
            } else {
                alert('Please enter a valid premium key.');
            }
        }

        function loadSettings() {
            const autoTheme = localStorage.getItem('axiomThemeAuto') === 'true';
            document.getElementById('auto-theme-toggle').checked = autoTheme;

        
            const searchEngine = localStorage.getItem('axiomSearchEngine') || 'https://search.brave.com/search?q=';
            document.getElementById('search-engine-select').value = searchEngine;

            const proxy = localStorage.getItem('axiomProxy') || 'scramjet';
            document.getElementById('proxy-select').value = proxy;

            const homepage = localStorage.getItem('axiomHomepage') || 'start';
            document.getElementById('homepage-select').value = homepage;

            const customHomepage = localStorage.getItem('axiomCustomHomepage');
            if (homepage === 'custom' && customHomepage) {
                document.getElementById('custom-homepage-input').value = customHomepage;
                document.getElementById('custom-homepage-item').style.display = 'block';
            }

            const devMode = localStorage.getItem('axiomDeveloperMode') === 'true';
            document.getElementById('developer-mode-toggle').checked = devMode;

            const blockPopups = localStorage.getItem('axiomBlockPopups') === 'true';
            document.getElementById('block-popups-toggle').checked = blockPopups;
        }

        function setupEventListeners() {
            document.getElementById('auto-theme-toggle').addEventListener('change', function(e) {
                localStorage.setItem('axiomThemeAuto', e.target.checked);
                if (e.target.checked && window.themeManager) {
                    window.themeManager.enableAutoTheme();
                }
            });

            document.getElementById('search-engine-select').addEventListener('change', function(e) {
                localStorage.setItem('axiomSearchEngine', e.target.value);
            });

            document.getElementById('proxy-select').addEventListener('change', function(e) {
                if (window.axiomPluginAPI) {
                    window.axiomPluginAPI.setProxy(e.target.value);
                }
            });

            document.getElementById('homepage-select').addEventListener('change', function(e) {
                const value = e.target.value;
                if (window.axiomPluginAPI) {
                    if (value === 'custom') {
                        document.getElementById('custom-homepage-item').style.display = 'block';
                    } else {
                        document.getElementById('custom-homepage-item').style.display = 'none';
                        window.axiomPluginAPI.setHomepage(value);
                    }
                }
            });

            document.getElementById('custom-homepage-input').addEventListener('input', function(e) {
                if (window.axiomPluginAPI) {
                    window.axiomPluginAPI.setHomepage('custom', e.target.value);
                }
            });

            document.getElementById('developer-mode-toggle').addEventListener('change', function(e) {
                localStorage.setItem('axiomDeveloperMode', e.target.checked);
            });

            document.getElementById('block-popups-toggle').addEventListener('change', function(e) {
                localStorage.setItem('axiomBlockPopups', e.target.checked);
            });
        }

        function clearBrowsingData() {
            localStorage.clear()
        }

        function resetSettings() {
            if (window.axiomPluginAPI) {
                window.axiomPluginAPI.resetAll();
            } else {
                alert('Plugin API not available. Settings reset manually.');
                localStorage.clear();
                document.cookie.split(';').forEach(cookie => {
                    document.cookie = cookie.replace(/^ +/, '').replace(/=.*/, `=;expires=${new Date().toUTCString()};path=/`);
                });
                window.location.reload();
            }
        }

        function loadSettings() {
            const validSearchEngines = ['https://search.brave.com/search?q=', 'https://www.google.com/search?q=', 'https://duckduckgo.com/?q=', 'https://www.bing.com/search?q='];
            const savedSearchEngine = localStorage.getItem('search') || 'https://search.brave.com/search?q=';
            if (!validSearchEngines.includes(savedSearchEngine)) {
                savedSearchEngine = 'https://search.brave.com/search?q=';
                localStorage.setItem('search', savedSearchEngine);
            }
            document.getElementById('search-engine-select').value = savedSearchEngine;

            const validHomepages = ['start.html', 'games.html', 'custom'];
            const savedHomepage = localStorage.getItem('axiomHomepage') || 'start.html';
            if (!validHomepages.includes(savedHomepage)) {
                savedHomepage = 'start.html';
                localStorage.setItem('axiomHomepage', savedHomepage);
            }
            document.getElementById('homepage-select').value = savedHomepage;

            const savedProxy = localStorage.getItem('axiomProxy') || 'scramjet';
            if (!['scramjet', 'ultraviolet'].includes(savedProxy)) {
                savedProxy = 'scramjet';
                localStorage.setItem('axiomProxy', 'scramjet');
            }
            document.getElementById('proxy-select').value = savedProxy;
            
            if (savedHomepage === 'custom') {
                document.getElementById('custom-homepage-item').style.display = 'block';
                const customUrl = localStorage.getItem('axiomCustomHomepage') || '';
                document.getElementById('custom-homepage-input').value = customUrl;
            }

            const autoThemeEnabled = window.themeManager ? window.themeManager.isAutoThemeEnabled() : false;
            document.getElementById('auto-theme-toggle').checked = autoThemeEnabled;

            const blockPopups = localStorage.getItem('axiomBlockPopups') !== 'false';
            document.getElementById('block-popups-toggle').checked = blockPopups;

            const developerMode = localStorage.getItem('axiomDeveloperMode') === 'true';
            document.getElementById('developer-mode-toggle').checked = developerMode;
        }

        function setupEventListeners() {
            document.getElementById('search-engine-select').addEventListener('change', function() {
                localStorage.setItem('search', this.value);
            });

            document.getElementById('homepage-select').addEventListener('change', function() {
                const value = this.value;
                localStorage.setItem('axiomHomepage', value);
                
                const customItem = document.getElementById('custom-homepage-item');
                if (value === 'custom') {
                    customItem.style.display = 'block';
                } else {
                    customItem.style.display = 'none';
                }
            });

            document.getElementById('proxy-select').addEventListener('change', function() {
                const value = this.value;
                localStorage.setItem('axiomProxy', value);
            });

            document.getElementById('custom-homepage-input').addEventListener('change', function() {
                localStorage.setItem('axiomCustomHomepage', this.value);
            });

            document.getElementById('auto-theme-toggle').addEventListener('change', function() {
                if (window.themeManager) {
                    if (this.checked) {
                        window.themeManager.enableAutoTheme();
                    } else {
                        window.themeManager.disableAutoTheme();
                    }
                }
            });

            document.getElementById('developer-mode-toggle').addEventListener('change', function() {
                localStorage.setItem('axiomDeveloperMode', this.checked);
            });

            document.getElementById('block-popups-toggle').addEventListener('change', function() {
                localStorage.setItem('axiomBlockPopups', this.checked);
            });
        }


        function clearBrowsingData() {
            if (confirm('Are you sure you want to clear all browsing data? This will remove all saved tabs and settings.')) {
                
                localStorage.clear();
                // remove cookies
                document.cookie.split(';').forEach(cookie => {
                    document.cookie = cookie.replace(/^ +/, '').replace(/=.*/, `=;expires=${new Date().toUTCString()};path=/`);
                });
                
                alert('Browsing data cleared successfully!');
                
                window.location.reload();
            }
        }

        function resetSettings() {
            if (confirm('Are you sure you want to reset all settings to their default values?')) {

                const keysToRemove = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && (key.startsWith('axiom') || key === 'search' || key === 'tabs')) {
                        keysToRemove.push(key);
                    }
                }
                
                keysToRemove.forEach(key => localStorage.removeItem(key));
            
                if (window.themeManager) {
                    window.themeManager.setTheme('dark');
                }
                
                alert('Settings have been reset to default values!');
                window.location.reload();
            }
        }
    function addPremiumKey() {
            const key = document.getElementById('premium-key-input').value.trim();
            if (key) {
                window.axiom.setKey(key);
                window.axiom.getKeyInfo(key);
                alert('Premium key added and verified.');
            } else {
                alert('Please enter a valid premium key.');
            }
        }
        </script>
</body>

</html>